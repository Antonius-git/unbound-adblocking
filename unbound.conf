# Unbound configuration file for Debian.
#
# See the unbound.conf(5) man page.
#
server:
	# If you give "" no chroot is performed. The path must not end in a /.
	# chroot: ""
	# if given, user privileges are dropped (after binding port),
	# and the given username is assumed. Default is user "unbound".
	# If you give "" no privileges are dropped.
	username: ""
	#username: unbound
	#chroot: "/etc/unbound"
  	directory: "/etc/unbound"
	pidfile: "/etc/unbound/unbound.pid"
	#pidfile: "/run/unbound.pid"
	#tls-cert-bundle: "/usr/share/ca-certificates/CAcert/root_X0F.crt"


	#########################################
	# integration LOG's 
	#
	verbosity: 1
	#logfile: "/etc/unbound/etc/unbound/unbound.log"
	#log-queries: yes
	#log-replies: yes
	#########################################

	do-ip4: yes
	do-ip6: no
	do-udp: yes
	do-tcp: yes

	interface: 127.0.0.1
	port: 53
	access-control: 0.0.0.0/0 refuse
	access-control: 127.0.0.0/8 allow
	

	# private networks:
	#private-address: 127.0.0.0/8 #would hinder many spamblocklists as they use that, see:
	#https://manpages.debian.org/stretch/unbound/unbound.conf.5.en.html
	private-address: 100.64.0.0/10
	private-address: 169.254.0.0/16
	private-address: 10.0.0.0/8
	private-address: 172.16.0.0/12
	private-address: 192.168.0.0/16	
	private-address: ::ffff:0:0/96 #stops IPv4-mapped IPv6 addresses from bypassing the filter.
	
	#these disable dnssec validation for, and allow communication with, other lan members.
	private-domain: "intranet"
	private-domain: "internal"
	private-domain: "private"
	private-domain: "corp"
	private-domain: "home"
	private-domain: "lan"
	unblock-lan-zones: yes
	insecure-lan-zones: yes
	domain-insecure: "intranet"
	domain-insecure: "internal"
	domain-insecure: "private"
	domain-insecure: "corp"
	domain-insecure: "home"
	domain-insecure: "lan"

	# threads and memory slabs for threads
	num-threads: 4
	msg-cache-slabs: 8
	rrset-cache-slabs: 8
	infra-cache-slabs: 8
	key-cache-slabs: 8

	#memory cache
	msg-cache-size: 128m
	rrset-cache-size: 256m
	cache-min-ttl: 3600
	cache-max-ttl: 86400
	# the amount of memory to use for the key cache. default is "4Mb".
	key-cache-size: 32m
	#incoming-num-tcp: 1000
	#outgoing-num-tcp: 1000

	# prefetch will only work when there is only 10% of TTL time left
	# so basically with a 30 secs TTL, if you dont do another lookup within the last 3 seconds of the TTL, 
	# then prefetch isnt providing you any benefit. Its operating scope is too narrow.

	# Unbound implemented serve expired, what it does is when a record is expired, it will stay in the cache with the TTL value as 0,
	# if another lookup comes in from e.g the LAN, then it will be served as a cached record for performance. 
	# However at the same time a new lookup is initiated from unbound to the authoritative server, so when there is a newer lookup later, it will server a newer record.
	# So its important to note the same expired record isnt served forever, its only served once, then a new one is fetched.
	prefetch: yes
	prefetch-key: yes
	minimal-responses: yes
	serve-expired: yes
	serve-expired-ttl-reset: yes

	# gentle on recursion
	hide-identity: yes
	hide-version: yes
	do-not-query-localhost: no


	# Limit DNS Fraud and use DNSSEC
	aggressive-nsec: yes
	harden-glue: yes
	harden-dnssec-stripped: yes

	use-caps-for-id: yes
	# Domains (and domains in them) without support for dns-0x20 and
	# the fallback fails because they keep sending different answers.
	caps-whitelist: "licdn.com"
	caps-whitelist: "senderbase.org"
	#caps-whitelist: ""


	# Harden the referral path by performing additional queries for
	# infrastructure data.  Validates the replies (if possible).
	# Default off, because the lookups burden the server.  Experimental
	# implementation of draft-wijngaards-dnsext-resolver-side-mitigation.
	harden-referral-path: no

	harden-algo-downgrade: no 
	# false positives with improperly configured zones
	
	rrset-roundrobin: yes
	# ROOT Servers
	root-hints: "root.hints"

	# DNSSEC
	module-config: "validator iterator"
	auto-trust-anchor-file: "root.key"

	# File with DLV trusted keys. Same format as trust-anchor-file.
	#There can be only one DLV configured, it is trusted from root down.
	# Download http://ftp.isc.org/www/dlv/dlv.isc.org.key
	#DLV is going  to  be  decommissioned
	# So DON'T USE THIS OPTION ANYMORE.
	#dlv-anchor-file: "dlv.isc.org.key"

	# the amount of memory to use for the negative cache (used for DLV).
	# plain value in bytes or you can append k, m or G. default is "1Mb".
	neg-cache-size: 0

	# Maximum UDP response size (not applied to TCP response).
	# Suggested values are 512 to 4096. Default is 4096. 65536 disables it.
	# max-udp-size: 512

	# This is the best fix, because it allows your server to run better with large responses, and generally cleans up your network.
	# EDNS reassembly buffer to advertise to UDP peers (the actual buffer is set with msg-buffer-size). 1472/1480 can solve fragmentation (timeouts).
	# currently starts, by default, with 4096 and if that fails will try 1232 for IPv6 and 1472 for IPv4.
	# edns-buffer-size: 512

	# buffer size for handling DNS data. No messages larger than this
	# size can be sent or received, by UDP or TCP. In bytes.
	# Default is 65552 bytes, enough for 64 Kb packets, the maximum DNS message size
	# msg-buffer-size: 65552

	# Unbound Optimization and Speed Tweaks ###
	#
	# Improves privacy and performance, reducing data exposure 
	# https://ripe72.ripe.net/presentations/120-unbound_qnamemin_ripe72.pdf
	qname-minimisation: yes
	harden-below-nxdomain: yes
	
	# buffer size for UDP port 53 incoming (SO_RCVBUF socket option). This sets
	# the kernel buffer larger so that no messages are lost in spikes in the traffic.
   	so-rcvbuf: 1m

	# Faster UDP with multithreading (only on Linux).
    	so-reuseport: yes


	# If nonzero, unwanted replies are not only reported in statistics, but also
	# a running total is kept per thread. If it reaches the threshold, a warning
	# is printed and a defensive action is taken, the cache is cleared to flush
	# potential poison out of it.  A suggested value is 10000000, the default is
	# 0 (turned off). We think 10K is a good value.
	unwanted-reply-threshold: 0

	# Should additional section of secure message also be kept clean of unsecure
	# data. Useful to shield the users of this validator from potential bogus
	# data in the additional section. All unsigned data in the additional section
	# is removed from secure messages.
	val-clean-additional: yes
	
	# include my nice blocklist
	include: "blocklist_big.conf"
	# OR if you'd prefer a more lenient one for social media, comment the big one out 
	# and uncomment the following smaller one:
	# include: "lenient_unbound_blocklist.conf"


#remote-control:
	#control-enable: yes
	#control-interface: 127.0.0.2
	#control-port: 953
	#server-key-file: "/etc/unbound/unbound_server.key"
	#server-cert-file: "/etc/unbound/unbound_server.pem"
	#control-key-file: "/etc/unbound/unbound_control.key"
	#control-cert-file: "/etc/unbound/unbound_control.pem"





